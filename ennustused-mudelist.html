<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="Bayesi statistika kasutades R keelt" />
<meta property="og:type" content="book" />

<meta property="og:image" content="img/cyclo.png" />
<meta property="og:description" content="Praktilise kursuse ‘Reprodutseeritav andmeanalüüs R keeles’ Bayesi statistika materjalid." />
<meta name="github-repo" content="rstats-tartu/bayesiraamat" />

<meta name="author" content="Taavi Päll" />
<meta name="author" content="Ülo Maiväli" />


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="Praktilise kursuse ‘Reprodutseeritav andmeanalüüs R keeles’ Bayesi statistika materjalid.">

<title>Bayesi statistika kasutades R keelt</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>

<script src="https://use.fontawesome.com/e4ba4259a1.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="toc.css" type="text/css" />

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#saateks">Saateks</a></li>
<li class="part"><span><b>I OSA</b></span></li>
<li class="has-sub"><a href="1-sissejuhatus-maailm-teooria-ja-mudel.html#sissejuhatus-maailm-teooria-ja-mudel"><span class="toc-section-number">1</span> Sissejuhatus: maailm, teooria ja mudel</a><ul>
<li><a href="suur-ja-vaike-maailm.html#suur-ja-vaike-maailm">Suur ja väike maailm</a></li>
<li><a href="mudeli-vaike-maailm.html#mudeli-vaike-maailm">Mudeli väike maailm</a></li>
</ul></li>
<li class="has-sub"><a href="2-lineaarsed-mudelid.html#lineaarsed-mudelid"><span class="toc-section-number">2</span> Lineaarsed mudelid</a><ul>
<li><a href="ennustus-lineaarsest-mudelist.html#ennustus-lineaarsest-mudelist">Ennustus lineaarsest mudelist</a></li>
<li><a href="neli-moistet.html#neli-moistet">Neli mõistet</a></li>
<li><a href="mudeli-fittimine.html#mudeli-fittimine">Mudeli fittimine</a></li>
<li><a href="ule-ja-alafittimine.html#ule--ja-alafittimine">Üle- ja alafittimine</a></li>
</ul></li>
<li class="has-sub"><a href="3-kaks-lineaarse-mudeli-laiendust.html#kaks-lineaarse-mudeli-laiendust"><span class="toc-section-number">3</span> Kaks lineaarse mudeli laiendust</a><ul>
<li><a href="mitme-soltumatu-prediktoriga-mudel.html#mitme-soltumatu-prediktoriga-mudel">Mitme sõltumatu prediktoriga mudel</a></li>
<li><a href="interaktsioonimudel.html#interaktsioonimudel">Interaktsioonimudel</a></li>
<li class="has-sub"><a href="veamudel.html#veamudel">Veamudel</a><ul>
<li><a href="veamudel.html#enimkasutatud-veamudel-on-normaaljaotus">Enimkasutatud veamudel on normaaljaotus</a></li>
<li><a href="veamudel.html#normaaljaotuse-mudel-vaikestel-valimitel">Normaaljaotuse mudel väikestel valimitel</a></li>
<li><a href="veamudel.html#normaaljaotuse-ja-lognormaaljaotuse-erilisus">Normaaljaotuse ja lognormaaljaotuse erilisus</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="4-kusimused-mida-statistika-kusib.html#kusimused-mida-statistika-kusib"><span class="toc-section-number">4</span> Küsimused, mida statistika küsib</a><ul>
<li><a href="jata-meelde.html#jata-meelde">Jäta meelde</a></li>
</ul></li>
<li class="has-sub"><a href="5-kuidas-naevad-valja-teie-andmed.html#kuidas-naevad-valja-teie-andmed"><span class="toc-section-number">5</span> Kuidas näevad välja teie andmed</a><ul>
<li><a href="summaarsed-statistikud.html#summaarsed-statistikud">Summaarsed statistikud</a></li>
<li><a href="keskvaartused.html#keskvaartused">Keskväärtused</a></li>
<li><a href="muutuja-sisene-varieeruvus.html#muutuja-sisene-varieeruvus">Muutuja sisene varieeruvus</a></li>
<li><a href="logaritmi-andmed.html#logaritmi-andmed">Logaritmi andmed</a></li>
<li><a href="iseloomusta-andmeid-algses-skaalas-mediaan-mad.html#iseloomusta-andmeid-algses-skaalas-mediaan-mad">Iseloomusta andmeid algses skaalas: mediaan (MAD)</a></li>
<li><a href="muutujate-koosvarieeruvus.html#muutujate-koosvarieeruvus">Muutujate koosvarieeruvus</a></li>
</ul></li>
<li class="has-sub"><a href="6-eda-eksploratoorne-andmeanaluus.html#eda-eksploratoorne-andmeanaluus"><span class="toc-section-number">6</span> EDA — eksploratoorne andmeanalüüs</a><ul>
<li><a href="6-1-eda-kokkuvote.html#eda-kokkuvote"><span class="toc-section-number">6.1</span> EDA kokkuvõte</a></li>
</ul></li>
<li class="has-sub"><a href="7-jareldav-statistika.html#jareldav-statistika"><span class="toc-section-number">7</span> Järeldav statistika</a><ul>
<li class="has-sub"><a href="jareldav-statistika-on-toenaosusteooria-kaepikendus.html#jareldav-statistika-on-toenaosusteooria-kaepikendus">Järeldav statistika on tõenäosusteooria käepikendus</a><ul>
<li><a href="jareldav-statistika-on-toenaosusteooria-kaepikendus.html#formaalsed-tuletised-toenaosusteooria-aksioomidest">Formaalsed tuletised tõenäosusteooria aksioomidest</a></li>
<li><a href="jareldav-statistika-on-toenaosusteooria-kaepikendus.html#naited-toenaosusteooria-tuletiste-rakendamisest">Näited tõenäosusteooria tuletiste rakendamisest</a></li>
<li><a href="jareldav-statistika-on-toenaosusteooria-kaepikendus.html#toenaosuse-tolgendus">Tõenäosuse tõlgendus</a></li>
<li><a href="jareldav-statistika-on-toenaosusteooria-kaepikendus.html#toenaosusteooriast-tulenevad-statistika-pohiprintsiibid">Tõenäosusteooriast tulenevad statistika põhiprintsiibid</a></li>
</ul></li>
<li><a href="andmed-ei-ole-sama-mis-tegelikkus.html#andmed-ei-ole-sama-mis-tegelikkus">Andmed ei ole sama, mis tegelikkus</a></li>
</ul></li>
<li class="part"><span><b>II OSA</b></span></li>
<li class="has-sub"><a href="8-bootstrappimine.html#bootstrappimine"><span class="toc-section-number">8</span> Bootstrappimine</a><ul>
<li><a href="veidi-keerulisem-bootstrap.html#veidi-keerulisem-bootstrap">Veidi keerulisem bootstrap</a></li>
<li><a href="bayesboot.html#bayesboot">bayesboot()</a></li>
<li><a href="parameetriline-bootstrap.html#parameetriline-bootstrap">Parameetriline bootstrap</a></li>
<li><a href="bootstrappimine-ei-ole-kogu-tode.html#bootstrappimine-ei-ole-kogu-tode">Bootstrappimine ei ole kogu tõde</a></li>
</ul></li>
<li class="has-sub"><a href="9-bayesi-pohimote.html#bayesi-pohimote"><span class="toc-section-number">9</span> Bayesi põhimõte</a><ul>
<li><a href="esimene-naide.html#esimene-naide">Esimene näide</a></li>
<li><a href="teine-naide-sonastame-oma-probleemi-umber.html#teine-naide-sonastame-oma-probleemi-umber">Teine näide: sõnastame oma probleemi ümber</a></li>
<li><a href="kui-n-1.html#kui-n-1">Kui n = 1</a></li>
</ul></li>
<li class="has-sub"><a href="10-mudelite-keel.html#mudelite-keel"><span class="toc-section-number">10</span> Mudelite keel</a><ul>
<li><a href="beta-prior.html#beta-prior">Beta prior</a></li>
<li><a href="prioritest-uldiselt.html#prioritest-uldiselt">Prioritest üldiselt</a></li>
</ul></li>
<li class="has-sub"><a href="ennustame-pidevat-suurust.html#ennustame-pidevat-suurust">Ennustame pidevat suurust</a><ul>
<li class="has-sub"><a href="lihtne-normaaljaotuse-mudel.html#lihtne-normaaljaotuse-mudel">Lihtne normaaljaotuse mudel</a><ul>
<li><a href="lihtne-normaaljaotuse-mudel.html#kui-lai-on-meie-toeparafunktsioon">Kui lai on meie tõepärafunktsioon?</a></li>
<li><a href="lihtne-normaaljaotuse-mudel.html#lihtne-voi-robustne-normaalne-mudel">Lihtne või robustne normaalne mudel?</a></li>
<li><a href="lihtne-normaaljaotuse-mudel.html#mcmc-ahelate-kvaliteet">MCMC ahelate kvaliteet</a></li>
<li><a href="lihtne-normaaljaotuse-mudel.html#naide-usa-presidentide-keskmine-pikkus">Näide: USA presidentide keskmine pikkus</a></li>
</ul></li>
<li><a href="lineaarne-regressioon.html#lineaarne-regressioon">Lineaarne regressioon</a></li>
<li><a href="lm-vahimruutude-meetodiga-fititud-lineaarsed-mudelid.html#lm---vahimruutude-meetodiga-fititud-lineaarsed-mudelid"><code>lm()</code> - vähimruutude meetodiga fititud lineaarsed mudelid</a></li>
<li><a href="bayesi-meetodil-lineaarse-mudeli-fittimine.html#bayesi-meetodil-lineaarse-mudeli-fittimine">Bayesi meetodil lineaarse mudeli fittimine</a></li>
<li class="has-sub"><a href="ennustused-mudelist.html#ennustused-mudelist">Ennustused mudelist</a><ul>
<li><a href="ennustused-mudelist.html#lognormaalne-toeparamudel">Lognormaalne tõepäramudel</a></li>
</ul></li>
<li class="has-sub"><a href="mitme-prediktoriga-lineaarne-regressioon.html#mitme-prediktoriga-lineaarne-regressioon">Mitme prediktoriga lineaarne regressioon</a><ul>
<li><a href="mitme-prediktoriga-lineaarne-regressioon.html#mudeldamine-standardiseeritud-andmetega">Mudeldamine standardiseeritud andmetega</a></li>
</ul></li>
<li class="has-sub"><a href="keerulisemate-mudelitega-tootamine.html#keerulisemate-mudelitega-tootamine">Keerulisemate mudelitega töötamine</a><ul>
<li><a href="keerulisemate-mudelitega-tootamine.html#predictor-residual-plots">Predictor residual plots</a></li>
<li><a href="keerulisemate-mudelitega-tootamine.html#ennustavad-plotid">Ennustavad plotid</a></li>
<li><a href="keerulisemate-mudelitega-tootamine.html#posterior-prediction-plots">Posterior prediction plots</a></li>
<li><a href="keerulisemate-mudelitega-tootamine.html#interaktsioonid-prediktorite-vahel">Interaktsioonid prediktorite vahel</a></li>
<li><a href="keerulisemate-mudelitega-tootamine.html#interaktsioonid-pidevatele-tunnustele">Interaktsioonid pidevatele tunnustele</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="11-hierarhilised-mudelid.html#hierarhilised-mudelid"><span class="toc-section-number">11</span> Hierarhilised mudelid</a><ul>
<li><a href="shrinkage.html#shrinkage">Shrinkage</a></li>
<li><a href="anova-laadne-mudel.html#anova-laadne-mudel">ANOVA-laadne mudel</a></li>
<li><a href="vabad-interceptid-klassikalises-regressioonimudelis.html#vabad-interceptid-klassikalises-regressioonimudelis">Vabad interceptid klassikalises regressioonimudelis</a></li>
<li><a href="vabad-tousud-ja-interceptid.html#vabad-tousud-ja-interceptid">Vabad tõusud ja interceptid</a></li>
<li><a href="hierarhiline-mudel-pidevate-prediktoritega.html#hierarhiline-mudel-pidevate-prediktoritega">Hierarhiline mudel pidevate prediktoritega</a></li>
</ul></li>
<li class="appendix"><span><b>Lisa</b></span></li>
<li class="has-sub"><a href="A-bayesi-ja-sagedusliku-statistika-vordlus.html#bayesi-ja-sagedusliku-statistika-vordlus"><span class="toc-section-number">A</span> Bayesi ja sagedusliku statistika võrdlus</a><ul>
<li><a href="kaks-statistikat-ajaloost-ja-toenaosusest.html#kaks-statistikat-ajaloost-ja-toenaosusest">Kaks statistikat: ajaloost ja tõenäosusest</a></li>
<li><a href="poleemika-kumbki-toenaosus-pole-paris-see-mida-uldiselt-arvatakse.html#poleemika-kumbki-toenaosus-pole-paris-see-mida-uldiselt-arvatakse">Poleemika: kumbki tõenäosus pole päris see, mida üldiselt arvatakse</a></li>
<li class="has-sub"><a href="vordlev-naide-kahe-grupi-vordlus.html#vordlev-naide-kahe-grupi-vordlus">Võrdlev näide: kahe grupi võrdlus</a><ul>
<li><a href="vordlev-naide-kahe-grupi-vordlus.html#bayesiaan">Bayesiaan</a></li>
<li><a href="vordlev-naide-kahe-grupi-vordlus.html#sageduslik-statistik">Sageduslik statistik</a></li>
<li><a href="vordlev-naide-kahe-grupi-vordlus.html#tulemuste-tolgendamine">Tulemuste tõlgendamine</a></li>
</ul></li>
<li><a href="kahe-paradigma-erinevused.html#kahe-paradigma-erinevused">Kahe paradigma erinevused</a></li>
<li><a href="statistiline-ennustus-kui-mitmetasandiline-protsess.html#statistiline-ennustus-kui-mitmetasandiline-protsess">Statistiline ennustus kui mitmetasandiline protsess</a></li>
</ul></li>
<li><a href="B-sonastik.html#sonastik"><span class="toc-section-number">B</span> Sõnastik</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="ennustused-mudelist" class="section level2 unnumbered">
<h2>Ennustused mudelist</h2>
<p>Kuidas plottida meie hinnangud ebakindlusele parameetri tegeliku väärtuse ümber? Siin tuleb appi <code>rethinking::link()</code>.</p>
<p>Nii tõmbame posteriorist igale meie andmetes esinevale log GDP väärtusele vastavad 1000 ennustust keskmise eluea kohta sellel l_GDP väärtusel:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">linked &lt;-<span class="st"> </span><span class="kw">link</span>(gapmod8)
linked &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(linked)
linked_mean &lt;-<span class="st"> </span><span class="kw">apply</span>(linked, <span class="dv">2</span>, HPDI, <span class="dt">prob =</span> <span class="fl">0.95</span>)</code></pre></div>
<p>Sel viisil saab tabeli, kus igale 142-le andmepunktist vastab üks veerg, milles on 1000 posteeriorist arvutatud ennustust lifeExp väärtusele.</p>
<p>Praktikas soovime aga enamasti meie poolt ette antud l_GDP väärtustel põhinevaid ennustusi keskmise eluea kohta. See käib nii:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># link() draws from the posterior 1000 mu values for each l_GDP value in the width object; out pops a table with 1000 rows and 41 columns. </span>
mu1 &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">link</span>(gapmod8, <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">l_GDP =</span> <span class="kw">seq</span>(<span class="dv">2</span>, <span class="dv">6</span>, <span class="fl">0.1</span>))))
<span class="co">#&gt; [ 100 / 1000 ]</span>
[ <span class="dv">200</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">300</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">400</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">500</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">600</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">700</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">800</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">900</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">1000</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]</code></pre></div>
<p>Nüüd on meil mu1 objektis 41 l_GDP väärtust, millest igale vastab 1000 ennustust keskmise eluea kohta sellel l_GDP-l. Järgmiseks arvutame igale neist 41-st tulbast keskmise ja 95% HPDI ning plotime need koos andmepunktidega kasutades base-R graafikasüsteemi.</p>
<p>Pane tähele, et hall riba näitab ebakindlust ennustuse ümber keskmisele elueale üle kõikide riikide, mis võiksid sellist l_GDP-d omada (ehk ebakindlust regressioonijoonele). Kui me aga tahame ennustada ka keskmiste eluigade varieeruvust riigi tasemel (kasutades Bayesi hinnangut sigma parameetrile), siis on meil vaja <code>sim()</code> funktsiooni:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mu.mean &lt;-<span class="st"> </span><span class="kw">apply</span>(mu1, <span class="dv">2</span>, mean) <span class="co"># applies the FUN mean() to each column</span>
mu.HPDI &lt;-<span class="st"> </span><span class="kw">apply</span>(mu1, <span class="dv">2</span>, HPDI, <span class="dt">prob =</span> <span class="fl">0.95</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">t</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as_data_frame</span>()
mu.HPDI &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(<span class="dt">width =</span> <span class="kw">seq</span>(<span class="dv">2</span>, <span class="dv">6</span>, <span class="fl">0.1</span>), mu.HPDI)
<span class="kw">colnames</span>(mu.HPDI) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;width&quot;</span>, <span class="st">&quot;lower&quot;</span>, <span class="st">&quot;upper&quot;</span>)
sim.length &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">sim</span>(gapmod8, <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">l_GDP =</span> <span class="kw">seq</span>(<span class="dv">2</span>, <span class="dv">6</span>, <span class="fl">0.1</span>))))
<span class="co">#&gt; [ 100 / 1000 ]</span>
[ <span class="dv">200</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">300</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">400</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">500</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">600</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">700</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">800</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">900</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">1000</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
height.PI &lt;-<span class="st"> </span><span class="kw">sapply</span>(sim.length, PI, <span class="dt">prob =</span> <span class="fl">0.95</span>, <span class="dt">simplify =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">do.call</span>(rbind,. )
height.PI &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dt">width =</span> <span class="kw">seq</span>(<span class="dv">2</span>, <span class="dv">6</span>, <span class="fl">0.1</span>), height.PI) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()
<span class="kw">colnames</span>(height.PI) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;width&quot;</span>, <span class="st">&quot;lower&quot;</span>, <span class="st">&quot;upper&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(viridis)
<span class="kw">ggplot</span>(g2007) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(l_GDP, lifeExp, <span class="dt">color =</span> continent)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> <span class="kw">data_frame</span>(<span class="dt">width =</span> <span class="kw">seq</span>(<span class="dv">2</span>, <span class="dv">6</span>, <span class="fl">0.1</span>), mu.mean), <span class="kw">aes</span>(width, mu.mean)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">data =</span> mu.HPDI, <span class="kw">aes</span>(<span class="dt">x =</span> width, <span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper), 
              <span class="dt">fill =</span> <span class="st">&quot;grey5&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">data =</span> height.PI, <span class="kw">aes</span>(<span class="dt">x =</span> width, <span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper), 
              <span class="dt">fill =</span> <span class="st">&quot;grey50&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">caption =</span> <span class="st">&quot;Dark grey, 95% HDPI - highest posterior density.</span><span class="ch">\n</span><span class="st">Light grey, 95% PI - percentile interval.&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.title =</span> <span class="kw">element_blank</span>()) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_viridis</span>(<span class="dt">discrete =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-71"></span>
<img src="11_pidev_files/figure-html/unnamed-chunk-71-1.png" alt="Ennustused mudelist." width="70%" />
<p class="caption">
Joonis 10.13: Ennustused mudelist.
</p>
</div>
<p>Nüüd ütleb laiem hall ala, et me oleme üsna kindlad, et nende riikide puhul, mille puhul mudel töötab, kohtame individaalsete riikide keskmiseid eluigasid halli ala sees ja mitte sealt väljas. Nagu näha, on meil ka riike, mis jäävad hallist alast kaugele ja mille keskmine eluiga on kõvasti madalam, kui mudel ennustab. Need on äkki riigid, kus parasjagu on sõda üle käinud ja mille eluiga ei ole näiteks seetõttu SKP-ga lihtsas põhjuslikus seoses. Igal juhul tasuks need ükshaaval üle vaadata sest punktid, mida mudel ei seleta, võivad varjata endas mõnd huvitavat saladust, mis pikisilmi ootab avastajat. Lisaks: pane tähele, et mudel eeldab, et riikide keskmise eluea SD on muutumatu igal GDP väärtusel.</p>
<p>Kuidas saada ennustusi kindlale l_GDP väärtusele? Näiteks tulp V10 vastab l_GDP väärtusele 2.9. Järgnevalt arvutame oodatavad keskmised eluead sellele SKP väärtusele (fiksionaalsetele riikidele, millel võiks olla täpselt selline SKP):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dens</span>(sim.length<span class="op">$</span>V10)
<span class="kw">HPDI</span>(sim.length<span class="op">$</span>V10, <span class="dt">prob =</span> <span class="fl">0.95</span>)
<span class="co">#&gt; |0.95 0.95| </span>
<span class="co">#&gt;  38.1  65.7</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-72"></span>
<img src="11_pidev_files/figure-html/unnamed-chunk-72-1.png" alt="Ennustus mudelist kindlale log GDP väärtusele." width="70%" />
<p class="caption">
Joonis 10.14: Ennustus mudelist kindlale log GDP väärtusele.
</p>
</div>
<p>Nagu näha, võib mudeli kohaselt sellise riigi keskmine eluiga tulla nii madal, kui 40 aastat ja nii kõrge kui 67 aastat.</p>
<div id="lognormaalne-toeparamudel" class="section level3 unnumbered">
<h3>Lognormaalne tõepäramudel</h3>
<p>See mudel on alternatiiv andmete logaritmimisele, kui Y-muutuja (see muutuja, mille väärtust te ennustate) on lognormaalse jaotusega.</p>
<blockquote>
<p>Lognormaalne Y-i tõepäramudel on mittelineaarne. Lognormaaljaotus defineetitakse üle mu ja sigma, mis aga vastavd hoopis log(Y) normaaljaotuse mu-le ja sigmale.</p>
</blockquote>
<p>Seekord ennustame GDP-d keskmise eluea põhjal (mis, nagu näha jooniselt, ei ole küll päris lognormaalne).</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-73"></span>
<img src="11_pidev_files/figure-html/unnamed-chunk-73-1.png" alt="SKP-de jaotus" width="70%" />
<p class="caption">
Joonis 10.15: SKP-de jaotus
</p>
</div>
<p>Mustaga on näidatud empiiriline SKP jaotus, punasega fititud lognormaalne mudel sellest samast jaotusest. Järgnevalt ennustame SKP-d keskmise eluea põhjal, milleks fitime lognormaalse tõepäramudeli, kus mu on ümber defineeritud regressioonivõrrandiga:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m_ln1 &lt;-<span class="st"> </span><span class="kw">map2stan</span>(
  <span class="kw">alist</span>(
   gdpPercap  <span class="op">~</span><span class="st"> </span><span class="kw">dlnorm</span>( mu , sigma ),
    mu &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>b <span class="op">*</span><span class="st"> </span>lifeExp,
    a <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>( <span class="dv">0</span>, <span class="dv">10</span> ),
    b <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>( <span class="dv">0</span>, <span class="dv">10</span> ),
    sigma <span class="op">~</span><span class="st"> </span><span class="kw">dcauchy</span>( <span class="dv">0</span>, <span class="dv">2</span> ) 
   ), 
  <span class="dt">data =</span> g2007, 
  <span class="dt">start =</span> <span class="kw">list</span>( <span class="dt">a =</span> <span class="dv">3</span>, <span class="dt">b =</span> <span class="dv">0</span>, <span class="dt">sigma =</span> <span class="fl">0.5</span> ) 
  )</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">precis</span>(m_ln1)
<span class="co">#&gt;       Mean StdDev lower 0.89 upper 0.89 n_eff Rhat</span>
<span class="co">#&gt; a     2.48   0.38       1.87       3.08   283    1</span>
<span class="co">#&gt; b     0.09   0.01       0.08       0.10   287    1</span>
<span class="co">#&gt; sigma 0.81   0.05       0.74       0.88   294    1</span></code></pre></div>
<p>Logormaalses mudelis muutuvad parameetrite tähendused ja need tuleb lineaarse mudeli intercepti ja tõusu interpretatsioonidega kooskõlla viimiseks ümber arvutada. Kõigepealt avaldame tõusu. Kuna meil on tegemist mitte-lineaarse mudeliga, sõltub tõusu väärtus ka mudeli interceptist: <span class="math inline">\(slope = exp(\alpha + \beta)-exp(\alpha)\)</span>. See ei ole lineaarne seos: b omab seda suuremat mõju efektile (tõusule), mida suurem on a. [Kui meil on tegu binaarse X-ga (prediktoriga), siis kodeerime selle 2 taset kui -1 ja 1. Sellises mudelis on slope sama, mis efekti suurus ES, ja <span class="math inline">\(ES = exp(\alpha + \beta)-exp(\alpha-\beta)\)</span>]</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="kw">seq</span>( <span class="dv">0</span>, <span class="dv">10</span>, <span class="dt">length.out =</span> <span class="dv">1000</span> )
b &lt;-<span class="st"> </span><span class="dv">2</span>
b1 &lt;-<span class="st"> </span><span class="dv">3</span>
y &lt;-<span class="st"> </span><span class="kw">exp</span>( a <span class="op">+</span><span class="st"> </span>b ) <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>( a )
y1 &lt;-<span class="st"> </span><span class="kw">exp</span>( a <span class="op">+</span><span class="st"> </span>b1 ) <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>( a )

<span class="kw">plot</span>( a, y, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;a value&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;slope&quot;</span> )
<span class="kw">lines</span>( a, y1, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span> )</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-77"></span>
<img src="11_pidev_files/figure-html/unnamed-chunk-77-1.png" alt="Mudeli tõus sõltub interceptist." width="70%" />
<p class="caption">
Joonis 10.16: Mudeli tõus sõltub interceptist.
</p>
</div>
<p>Must joon näitab mudeli tõusu sõltuvust parameetri a väärtusest, kui parameeter b = 2. Punane joon teeb sedasama, kui b = 3.</p>
<p>Selline on siis mudeli tõusude (beta) posteerior:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s_ln1 &lt;-<span class="st"> </span><span class="kw">extract.samples</span>( m_ln1 ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.data.frame</span>()
beta &lt;-<span class="st"> </span><span class="kw">exp</span>(s_ln1<span class="op">$</span>a <span class="op">+</span><span class="st"> </span>s_ln1<span class="op">$</span>b) <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(s_ln1<span class="op">$</span>a)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dens</span>(beta)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-79"></span>
<img src="11_pidev_files/figure-html/unnamed-chunk-79-1.png" alt="Mudeli tõusude (beta) posteerior." width="70%" />
<p class="caption">
Joonis 10.17: Mudeli tõusude (beta) posteerior.
</p>
</div>
<p>Lognormaaljaotusega mudelis täidab normaaljaotusega mudeli intercepti rolli eelkõige meedian, mis on defineeritud kui exp(a), aga arvutada saab ka keskmise:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">i_median &lt;-<span class="st"> </span><span class="kw">exp</span>(s_ln1<span class="op">$</span>a)
<span class="kw">mean</span>(i_median)
<span class="co">#&gt; [1] 12.8</span>
i_mean &lt;-<span class="st"> </span><span class="kw">exp</span>(s_ln1<span class="op">$</span>a <span class="op">+</span><span class="st"> </span>(s_ln1<span class="op">$</span>sigma <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)
<span class="kw">mean</span>(i_mean)
<span class="co">#&gt; [1] 17.8</span></code></pre></div>
<p>Siin ennustame fititud mudelist uusi andmeid (väljamõeldud riikide rikkust):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_ci &lt;-<span class="st"> </span><span class="kw">sim</span>(m_ln1) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">apply</span>(<span class="dv">2</span>, HPDI, <span class="dt">prob =</span> <span class="fl">0.95</span>)
<span class="co">#&gt; [ 100 / 1000 ]</span>
[ <span class="dv">200</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">300</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">400</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">500</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">600</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">700</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">800</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">900</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]
[ <span class="dv">1000</span> <span class="op">/</span><span class="st"> </span><span class="dv">1000</span> ]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(g2007, <span class="kw">aes</span>(lifeExp, gdpPercap)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> continent), <span class="dt">size =</span> <span class="fl">0.8</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>( <span class="dt">ymin =</span> sim_ci[<span class="dv">1</span>,], <span class="dt">ymax =</span> sim_ci[<span class="dv">2</span>,]), <span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_viridis</span>(<span class="dt">discrete =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-82"></span>
<img src="11_pidev_files/figure-html/unnamed-chunk-82-1.png" alt="Ennustus mudelist." width="70%" />
<p class="caption">
Joonis 10.18: Ennustus mudelist.
</p>
</div>
<p>Ka see mudel jääb hätta Aafrika outlieritega, mille eluiga ei suuda ennustada rikkust.</p>
</div>
</div>
<p style="text-align: center;">
<a href="bayesi-meetodil-lineaarse-mudeli-fittimine.html"><button class="btn btn-default">Previous</button></a>
<a href="https://github.com/rstats-tartu/lectures/edit/master/11_pidev.Rmd"><button class="btn btn-default">Editeeri</button></a>
<a href="mitme-prediktoriga-lineaarne-regressioon.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
